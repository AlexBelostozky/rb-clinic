import{isNumericInput}from"./utils.js";import{isModifierKey}from"./utils.js";import{isEscKeyPressed}from"./utils.js";import{sendRequest}from"./api.js";const body=document.querySelector(".page__body"),navMain=document.querySelector(".header__nav"),modal=document.querySelector(".modal"),modalContainer=document.querySelector(".modal__container"),modalForm=document.querySelector(".modal__form"),resetButton=document.querySelector(".modal__button--reset"),closeModalButton=document.querySelector(".modal__button--close"),submitButton=document.querySelector(".modal__button--submit"),modalInputs=document.querySelectorAll(".modal__input"),nameInput=document.getElementById("client-name"),phoneInput=document.getElementById("client-phone"),nameErrorLabel=document.querySelector(".modal__input-error--name"),phoneErrorLabel=document.querySelector(".modal__input-error--phone"),modalLoader=document.querySelector(".modal__form-loader");function openModal(){modal.classList.remove("modal--hide"),body.classList.add("page__body--locked"),resetButton.addEventListener("click",onResetButtonClick),modalInputs.forEach((e=>{e.removeAttribute("required")})),nameInput.addEventListener("input",onNameInputChange),phoneInput.addEventListener("keydown",onPhoneInputKeydown),phoneInput.addEventListener("input",onPhoneInputChange),nameInput.addEventListener("blur",onNameInputBlur),phoneInput.addEventListener("blur",onPhoneInputBlur),submitButton.addEventListener("click",onSubmitButtonClick),closeModalButton.addEventListener("click",onCloseModalButtonClick),document.addEventListener("keydown",onModalEscKeydown),document.addEventListener("mousedown",outsideModalClick)}function onSubmitButtonClick(e){e.preventDefault();let t=nameInput.validity.valid&&phoneInput.validity.valid,n=!nameInput.value||!phoneInput.value;t&&!n?sendRequest(modalForm,showLoader,setSuccessLoader,setFailLoader,closeModal):(validateNameInput(),validatePhoneNumber())}function onCloseModalButtonClick(e){e.preventDefault(),closeModal()}function onModalEscKeydown(e){isEscKeyPressed(e)&&(e.preventDefault(),closeModal())}function outsideModalClick(e){modalContainer.contains(e.target)||closeModal()}function closeModal(){modal.classList.add("modal--hide"),nameInput.classList.remove("modal__input--valid"),nameInput.removeAttribute("required"),nameInput.value="",nameInput.setCustomValidity(""),nameErrorLabel.textContent=nameInput.validationMessage,phoneInput.classList.remove("modal__input--valid"),phoneInput.removeAttribute("required"),phoneInput.value="",phoneInput.setCustomValidity(""),phoneErrorLabel.textContent=phoneInput.validationMessage,modalLoader.style.display="none",navMain.classList.contains("header__nav--closed")&&body.classList.remove("page__body--locked"),resetButton.removeEventListener("click",onResetButtonClick),nameInput.removeEventListener("input",onNameInputChange),phoneInput.removeEventListener("keydown",onPhoneInputKeydown),phoneInput.removeEventListener("input",onPhoneInputChange),nameInput.removeEventListener("blur",onNameInputBlur),phoneInput.removeEventListener("blur",onPhoneInputBlur),submitButton.removeEventListener("click",onSubmitButtonClick),document.removeEventListener("keydown",onModalEscKeydown),document.removeEventListener("mousedown",outsideModalClick),closeModalButton.removeEventListener("click",onCloseModalButtonClick)}function onResetButtonClick(){validateNameInput(),nameInput.classList.remove("modal__input--valid"),validatePhoneNumber(phoneInput),phoneInput.classList.remove("modal__input--valid")}function onNameInputBlur(){validateNameInput()}function validateNameInput(){return nameInput.setAttribute("required",""),/^[\p{L}\p{M}'\s]+$/u.test(nameInput.value)?(nameInput.classList.add("modal__input--valid"),nameInput.removeAttribute("pattern"),nameInput.setCustomValidity(""),nameErrorLabel.textContent=nameInput.validationMessage,!0):(nameInput.classList.remove("modal__input--valid"),nameInput.setAttribute("pattern","/^[p{L}p{M}'s]+$/u"),nameInput.setCustomValidity("–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ—Å—Ç–æ—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ –±—É–∫–≤."),nameErrorLabel.textContent=nameInput.validationMessage,!1)}function onPhoneInputKeydown(e){isNumericInput(e)||isModifierKey(e)||event.preventDefault()}function onNameInputChange(){formatName(nameInput)}function formatName(e){e.value=e.value.charAt(0).toUpperCase()+e.value.slice(1)}function onPhoneInputChange(){formatPhoneNumber(phoneInput)}function onPhoneInputBlur(){phoneInput.setAttribute("required",""),validatePhoneNumber()}function formatPhoneNumber(e){const t=e.value.replace(/^\+7|\D/g,"").substring(0,10),n=t.substring(0,3),o=t.substring(3,6),a=t.substring(6,10);t.length>6?e.value=`+7 (${n}) ${o}‚Äì${a}`:t.length>3?e.value=`+7 (${n}) ${o}`:t.length>0&&(e.value=`+7 (${n}`)}function validatePhoneNumber(){return 10===phoneInput.value.replace(/^\+7|\D/g,"").substring(0,10).length?(phoneInput.classList.add("modal__input--valid"),phoneInput.setCustomValidity(""),phoneErrorLabel.textContent=phoneInput.validationMessage,phoneInput.removeAttribute("pattern"),!0):(phoneInput.classList.remove("modal__input--valid"),phoneInput.setCustomValidity("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–º–≤–æ–ª–æ–≤."),phoneErrorLabel.textContent=phoneInput.validationMessage,!1)}function showLoader(){modalLoader.style.display="flex",modalLoader.innerHTML="–ó–∞–ø–∏—Å—ã–≤–∞–µ–º...<br>‚úçÔ∏è"}function setSuccessLoader(){modalLoader.innerHTML="–ì–æ—Ç–æ–≤–æ!<br>‚úÖ"}function setFailLoader(){modalLoader.innerHTML="–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫...<br>üôÖ‚Äç‚ôÇÔ∏è"}export{openModal};